rm -fR ./bootimg.out
rm -fR ./kernel.zip
mkdir bootimg.out
mkdir -p ./ramdisk/system/lib/modules
cd structure.new
cp -fR ./*  ../ramdisk
cd ../ramdisk
find . | cpio -o -H newc | gzip > ../newramdisk.cpio.gz
cd ..
./tools/mkbootimg --kernel ./zImage.new/Image --ramdisk ./newramdisk.cpio.gz --pagesize 2048 -o ./bootimg.out/boot.img --cmdline 'console=ttyHSL0,115200,n8 androidboot.console=ttyHSL0 user_debug=31 ehci-hcd.park=3 lpm_levels.sleep_disabled=1 earlyprintk=msm_hsl_uart,0xf991e000 androidboot.hardware=htc_hima androidusb.pid=0x065c'

rm -fR ./ramdisk
rm -fR ./boot.img-kernel
rm -fR ./boot.img-ramdisk.gz
rm -fR ./newramdisk.cpio.gz

rm -fR ./kernel.out/boot/*
rm -fR ./kernel.out/system/lib/modules/*

if [ -f ./bootimg.out/boot.img ];
then
	cp -f ./bootimg.out/boot.img  ./kernel.out/boot/boot.img
	cp -fR ./modules.new/*  ./kernel.out/system/lib/modules
	
	echo "Creating final package"
	cd kernel.out
	zip -r -T -9 ../kernel.zip ./*
	cd ..
   echo "Done."
else
   echo "Compile FAILED!"
fi


