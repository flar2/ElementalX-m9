# delete everything
rm -fR kernelinjector.m9/structure.new/modules/*
rm -f kernelinjector.m9/zImage.new/Image
rm -f arch/arm64/boot/Image

#make clean

cd kernelinjector.m9
sh extract
cd ..

# make
make -j8 CONFIG_DEBUG_SECTION_MISMATCH=y

# copy modules
find drivers -type f -name '*.ko' -exec cp -f {} kernelinjector.m9/modules.new \;
find arch -type f -name '*.ko' -exec cp -f {} kernelinjector.m9/modules.new \;
find fs -type f -name '*.ko' -exec cp -f {} kernelinjector.m9/modules.new \;

# copy modules for debugging
find drivers -type f -name '*.ko' -exec cp -f {} ../tempmods \;
find arch -type f -name '*.ko' -exec cp -f {} ../tempmods \;
find fs -type f -name '*.ko' -exec cp -f {} ../tempmods \;

# copy zImage
cp -f arch/arm64/boot/Image kernelinjector.m9/zImage.new/Image

cd kernelinjector.m9
sh compile
cd ..

#gzip kernelinjector.m9/structure.new/modules/* kernelinjector.m9/modules.new/mods.tar.gz

# ready for further editing
#make clean

